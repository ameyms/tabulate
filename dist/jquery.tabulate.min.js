/*!  v0.2.0
(c) 2013 Amey Sakhadeo
MIT License: https://github.com/ameyms/tabulate/blob/master/LICENSE */
if(!jQuery)throw new Error("Tabulate requires jQuery");!function(a){var b=function(b){a("<div/>").text(b).html()},c=function(){var b=new a.Deferred,c={items:[],total:0,page:1};return b.resolve(c),b},d=function(a){return a},e=function(a,c,d){return b(d+"")},f=function(b){if(!a(this).hasClass("disabled")){var c=a(this).data("page"),d=b.data.tabulator;d.$el.trigger("pagechange",{page:c,__self__:!0}),d.moveTo(c)}},g=function(){var a,b=this.options.pagesI18n("next")||"Next",c=this.options.pagesI18n("prev")||"Previous";a='<li data-page="next"><a href="#">'+b+"</a></li>",a+='<li data-page="prev"><a href="#">'+c+"</a></li>",this.$paging.html(a)},h=function(){var a,b=this.options.pagesI18n("first")||"First",c=this.options.pagesI18n("last")||"Last";a='<li data-page="first"><a href="#">'+b+"</a></li>",a+='<li data-page="last"><a href="#">'+c+"</a></li>",this.$paging.html(a)},i=function(){var a=this.dataSet.currPage,b=this.dataSet.totalPages,c=this.dataSet.next,d=this.dataSet.prev;c||d?(this.enablePage("next",!!c),this.enablePage("prev",!!d)):a&&b&&(this.enablePage("next",b>a),this.enablePage("prev",a>1))};adjustPagination=function(){var a=this.dataSet.currPage,b=this.dataSet.totalPages;a&&b&&(this.enablePage("last",b>a),this.enablePage("first",a>1),this.enablePage(a,!1))};var j=function(a){this.$el=a};j.DEFAULTS={source:c,renderer:e,cellClass:"item-cell",cellMeta:a.noop,transpose:d,pagesI18n:a.noop},j.prototype={init:function(a){this.options=this.getOptions(a),this.$tableBody=this.$el.find("tbody"),this.$tableBody||(this.$el.find("thead").after("<tbody></tbody>"),this.$tableBody=this.$el.find("tbody")),this.$paging=this.options.pagination||this.options.pager,this.$paging&&this.initPaging(),this.initHandlers()},initHandlers:function(){var b=this,c={options:{page:1}};this.$el.on("load",c,a.proxy(this.fetch,this)),this.$paging&&(this.$paging.on("click","li",{tabulator:this},f),this.$el.on("pagechange",function(a){var c=a.data.page;a.data.__self__!==!0&&b.moveTo(c)}))},fetch:function(b){this.cols=this.$el.find("thead th").length;var c=this.options.source(b.data.options);c.done(a.proxy(this.afterFetch,this)).fail(a.proxy(this.loadFailure,this))},afterFetch:function(){this.dataSet=this.options.transpose.apply(this,arguments),this.renderRows(),this.renderPageButtons(),this.$paging&&this.adjustPaging()},loadFailure:function(){this.$el.trigger("loadfailure",arguments)},renderRows:function(){var b=this;this.$tableBody.html(""),a.each(this.dataSet.items,function(c,d){for(var e=a("<tr>"),f=0;f<b.cols;f++){var g=b.options.renderer(c,f,d,b.dataSet),h=b.options.cellClass(c,f,d,b.dataSet),i=b.options.cellMeta(c,f,d,b.dataSet),j=a("<td>");j.html(g).addClass(h).data(i),e.append(j)}b.$tableBody.append(e)}),this.$el.trigger("render")},renderPageButtons:function(){var a,b,c,d,e,f="";if(this.options.pagination){for(this.$paging.find('li[data-page-type="actual"]').remove(),d=this.dataSet.currPage,e=this.dataSet.totalPages,a=Math.max(1,d-2),b=Math.min(d+2,e),c=a;b>=c;c++)f+='<li data-page="'+c+'" data-page-type="actual">',f+='<a href="#">'+c+"</a></li>";this.$paging.find('li[data-page="first"]').after(f)}},moveTo:function(a){this.fetch({options:{page:a,next:this.dataSet.next}})},getDefaults:function(){return j.DEFAULTS},getOptions:function(b){var c;return b=a.extend({},this.getDefaults(),this.$el.data(),b),a.isFunction(b.cellClass)||(c=b.cellClass,b.cellClass=function(){return c}),b},initPaging:function(){this.options.pager?g.call(this):h.call(this)},adjustPaging:function(){this.options.pager?i.call(this):this.options.pagination&&adjustPagination.call(this)},enablePage:function(a,b){var c=this.$paging.find('li[data-page="'+a+'"]');"undefined"==typeof b||b?c.removeClass("disabled"):c.addClass("disabled")}},a.fn.extend({tabulate:function(b){return this.each(function(){var c=new j(a(this));c.init(b)}),a(this)}})}(jQuery,window);